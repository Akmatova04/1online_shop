{# store/templates/store/cart_detail.html #}
{% extends "store/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "–°–∏–∑–¥–∏–Ω —Å–æ–æ–¥–∞ —Å–µ–±–µ—Ç–∏“£–∏–∑" %}{% endblock %}

{% block content %}
    <h1>{% trans "–°–∏–∑–¥–∏–Ω —Å–æ–æ–¥–∞ —Å–µ–±–µ—Ç–∏“£–∏–∑" %}</h1>

    {% if messages %}
        <ul class="messages" style="list-style: none; padding: 0; margin-bottom: 15px;">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}" style="padding: 10px; border-radius: 5px; margin-bottom: 5px; color: white; background-color: {% if message.tags == 'success' %}#28a745{% elif message.tags == 'warning' %}#ffc107; color: black;{% elif message.tags == 'error' %}#dc3545{% else %}#17a2b8{% endif %};"{% endif %}>
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if cart %} {# –≠–≥–µ—Ä —Å–µ–±–µ—Ç—Ç–µ —Ç–æ–≤–∞—Ä –±–∞—Ä –±–æ–ª—Å–æ #}
        <table class="cart" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
            <thead>
                <tr>
                    <th style="text-align: left; padding: 8px; border-bottom: 2px solid #dee2e6;">{% trans "–°“Ø—Ä”©—Ç" %}</th>
                    <th style="text-align: left; padding: 8px; border-bottom: 2px solid #dee2e6;">{% trans "–¢–æ–≤–∞—Ä" %}</th>
                    <th style="text-align: center; padding: 8px; border-bottom: 2px solid #dee2e6;">{% trans "–°–∞–Ω—ã" %}</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 2px solid #dee2e6;">{% trans "–ë–∏—Ä–¥–∏–≥–∏–Ω–∏–Ω –±–∞–∞—Å—ã" %}</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 2px solid #dee2e6;">{% trans "–ñ–∞–ª–ø—ã –±–∞–∞—Å—ã" %}</th>
                    <th style="text-align: center; padding: 8px; border-bottom: 2px solid #dee2e6;">{% trans "”®—á“Ø—Ä“Ø“Ø" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart %} {# –°–µ–±–µ—Ç—Ç–µ–≥–∏ –∞—Ä –±–∏—Ä —Ç–æ–≤–∞—Ä “Ø—á“Ø–Ω —Å–∞–ø #}
                    {% with product=item.product %} {# –ü—Ä–æ–¥—É–∫—Ç –æ–±—ä–µ–∫—Ç–∏—Å–∏–Ω –∞–ª—É—É #}
                        <tr>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;">
                                <a href="{{ product.get_absolute_url }}">
                                    {% if product.image %}
                                        <img src="{{ product.image.url }}" alt="{{ product.name }}" style="height: 50px; width: auto;">
                                    {% else %}
                                        üõí
                                    {% endif %}
                                </a>
                            </td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;">
                                <a href="{{ product.get_absolute_url }}" style="color: #005b96; text-decoration: none;">{{ product.name }}</a>
                            </td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                                {# –°–∞–Ω–¥—ã –∂–∞“£—ã—Ä—Ç—É—É —Ñ–æ—Ä–º–∞—Å—ã #}
                                <form action="{% url 'store:cart_add' product.id %}" method="post" style="display: inline-flex; align-items: center;">
                                    {{ item.update_quantity_form.quantity }} {# –°–∞–Ω —Ç–∞–ª–∞–∞—Å—ã #}
                                    {{ item.update_quantity_form.update }} {# –ñ–∞—à—ã—Ä—É—É–Ω update=True —Ç–∞–ª–∞–∞—Å—ã #}
                                    {% csrf_token %}
                                    <button type="submit" style="padding: 5px 10px; margin-left: 5px; cursor: pointer;">{% trans "–ñ–∞“£—ã—Ä—Ç" %}</button>
                                </form>
                            </td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">{{ item.price }} —Å–æ–º</td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">{{ item.total_price }} —Å–æ–º</td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                                {# ”®—á“Ø—Ä“Ø“Ø —Ñ–æ—Ä–º–∞—Å—ã #}
                                <form action="{% url 'store:cart_remove' product.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" style="color: red; background: none; border: none; cursor: pointer; font-size: 1.2em;">√ó</button> {# √ó –±–µ–ª–≥–∏—Å–∏ #}
                                </form>
                            </td>
                        </tr>
                    {% endwith %}
                {% endfor %}
                <tr class="total" style="background-color: #f8f9fa;">
                    <td colspan="4" style="padding: 12px 8px; text-align: right; font-weight: bold;">{% trans "–ñ–∞–ª–ø—ã —Å—É–º–º–∞" %}:</td>
                    <td colspan="2" style="padding: 12px 8px; text-align: right; font-weight: bold; font-size: 1.2em;">{{ cart.get_total_price }} —Å–æ–º</td>
                </tr>
            </tbody>
        </table>

        <div class="cart-actions" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
            <a href="{% url 'store:home' %}" class="button" style="padding: 10px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 5px;">
                {% trans "–°–æ–æ–¥–∞–Ω—ã —É–ª–∞–Ω—Ç—É—É" %}
                <a href="{% url 'store:order_create' %}" class="button" style="padding: 10px 15px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px;">
                    {% trans "–ë—É–π—Ä—É—Ç–º–∞ –±–µ—Ä“Ø“Ø" %}
                </a>
        </div>

    {% else %} {# –≠–≥–µ—Ä —Å–µ–±–µ—Ç –±–æ—à –±–æ–ª—Å–æ #}
         <p>{% trans "–°–∏–∑–¥–∏–Ω —Å–µ–±–µ—Ç–∏“£–∏–∑ –±–æ—à." %}</p>
         <p><a href="{% url 'store:home' %}">{% trans "–î“Ø–∫”©–Ω–≥”© –∫–∞–π—Ç—É—É" %}</a></p>
    {% endif %}

{% endblock %}